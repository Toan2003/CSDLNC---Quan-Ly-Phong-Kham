USE QLPK_CSDL
GO

GO
--CẬP NHẬT HỒ SƠ BỆNH NHÂN
CREATE OR ALTER PROC capnhathosobenhnhan 
		@IDBENHNHAN CHAR(8), 
		@TENBN NVARCHAR(50),
		@IDPHONGKHAM CHAR(3),
		@NAMSINH DATE,
		@GIOITINH NVARCHAR(3),
		@TUOI INT,
		@SDT CHAR(10),
		@EMAIL VARCHAR(50), 
		@DIACHI NVARCHAR(200),
		@MATKHAU VARCHAR(10),
		@BACSIMD CHAR(8),
		@TTTQ NVARCHAR(100),
		@TTDU NVARCHAR(100),
		@THUOCCHONGCD NVARCHAR(30),
		@DATHANHTOAN FLOAT
AS
BEGIN TRAN
	BEGIN TRY
	IF (@IDBENHNHAN IS NULL)
	BEGIN
		PRINT N'THIẾU TRƯỜNG THÔNG TIN'
		ROLLBACK TRAN
		RETURN;
	END
	IF (@TENBN IS NULL)
	BEGIN
		PRINT N'HỌ TÊN BỆNH NHÂN KHÔNG ĐƯỢC ĐỂ TRỐNG'
		ROLLBACK TRAN
		RETURN;
	END
	IF (@IDPHONGKHAM IS NULL)
	BEGIN
		PRINT N'ID PHÒNG KHÁM KHÔNG ĐƯỢC ĐỂ TRỐNG'
		ROLLBACK TRAN
		RETURN;
	END
	IF (@NAMSINH IS NULL)
	BEGIN
		PRINT N'NĂM SINH KHÔNG ĐƯỢC ĐỂ TRỐNG'
		ROLLBACK TRAN
		RETURN;
	END
	IF (@GIOITINH IS NULL)
	BEGIN
		PRINT N'GIỚI TÍNH KHÔNG ĐƯỢC ĐỂ TRỐNG'
		ROLLBACK TRAN
		RETURN;
	END
	IF (@TUOI IS NULL)
	BEGIN
		PRINT N'TUỔI KHÔNG ĐƯỢC ĐỂ TRỐNG'
		ROLLBACK TRAN
		RETURN;
	END
	IF (@SDT IS NULL)
	BEGIN
		PRINT N'SỐ ĐIỆN THOẠI KHÔNG ĐƯỢC ĐỂ TRỐNG'
		ROLLBACK TRAN
		RETURN;
	END
	IF (@DIACHI IS NULL)
	BEGIN
		PRINT N'ĐỊA CHỈ KHÔNG ĐƯỢC ĐỂ TRỐNG'
		ROLLBACK TRAN
		RETURN;
	END
		UPDATE HOSOBENHNHAN
		SET TENBN = @TENBN, IDPHONGKHAM = @IDPHONGKHAM, NAMSINHBN = @NAMSINH, GIOITINHBN = @GIOITINH, TUOI = @TUOI, SODIENTHOAIBN = @SDT,
			EMAIL = @EMAIL, DIACHI = @DIACHI, MATKHAU = @MATKHAU, BACSIMD = @BACSIMD, TTTONGQUAN = @TTTQ, TINHTRANGDIUNG = @TTDU, 
			THUOCCHONGCHIDINH = @THUOCCHONGCD, DATHANHTOAN = @DATHANHTOAN
		WHERE @IDBENHNHAN = IDBENHNHAN
	END TRY
	BEGIN CATCH
		PRINT N'LỖI HỆ THỐNG'
		ROLLBACK TRAN
	END CATCH
COMMIT TRAN

